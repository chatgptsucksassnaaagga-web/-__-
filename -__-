-- =====================================
-- Krypth AJ â€“ Auto Joiner (FINAL)
-- =====================================

-- SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer

local request =
    (syn and syn.request) or
    (http and http.request) or
    (fluxus and fluxus.request) or
    (krnl and krnl.request) or
    request

if not request then
    warn("HTTP not supported")
    return
end

-- =====================================
-- CONFIG
-- =====================================
local SERVER_URL = "https://groups-patch-glad-pollution.trycloudflare.com/servers"
local AUTO_JOIN = false
local REFRESH_DELAY = 5

-- =====================================
-- FONT (SINGLE SOURCE OF TRUTH)
-- =====================================
local KrypthFont = Font.new(
    "rbxasset://fonts/families/TitilliumWeb.json",
    Enum.FontWeight.Bold,
    Enum.FontStyle.Normal
)

-- =====================================
-- GUI
-- =====================================
local Gui = Instance.new("ScreenGui", Player:WaitForChild("PlayerGui"))
Gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Main = Instance.new("Frame", Gui)
Main.Name = "Whole frame"
Main.Size = UDim2.new(0,277,0,374)
Main.Position = UDim2.new(0.4,0,0.2,0)
Main.BackgroundColor3 = Color3.fromRGB(27,27,27)
Main.BackgroundTransparency = 0.03
Main.BorderSizePixel = 0
Instance.new("UIDragDetector", Main)
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,2)

local stroke = Instance.new("UIStroke", Main)
stroke.Color = Color3.fromRGB(237,40,0)
stroke.Thickness = 2

-- TITLE
local Title = Instance.new("TextLabel", Main)
Title.Text = "Krypth AJ"
Title.Size = UDim2.new(0,140,0,30)
Title.Position = UDim2.new(0.03,0,-0.09,0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1,1,1)
Title.TextSize = 22
Title.FontFace = KrypthFont

-- LOGS TEXT
local LogsTxt = Instance.new("TextLabel", Main)
LogsTxt.Text = "LOGS"
LogsTxt.Size = UDim2.new(0,60,0,20)
LogsTxt.Position = UDim2.new(0.55,0,-0.05,0)
LogsTxt.BackgroundTransparency = 1
LogsTxt.TextColor3 = Color3.new(1,1,1)
LogsTxt.TextSize = 20
LogsTxt.FontFace = KrypthFont

-- BUTTON CREATOR
local function createButton(text, y)
    local b = Instance.new("TextButton", Main)
    b.Size = UDim2.new(0,76,0,31)
    b.Position = UDim2.new(0.021,0,y,0)
    b.Text = text
    b.TextColor3 = Color3.new(1,1,1)
    b.TextSize = 20
    b.FontFace = KrypthFont
    b.BackgroundColor3 = Color3.fromRGB(199,31,0)
    b.BorderSizePixel = 0
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,2)
    Instance.new("UIStroke", b).Color = Color3.fromRGB(237,40,0)
    return b
end

local RefreshBtn = createButton("REFRESH",0.024)
local AutoBtn    = createButton("AUTO JOIN",0.128)
local ClearBtn   = createButton("CLEAR",0.235)

-- SCROLLING LOG FRAME
local LogFrame = Instance.new("ScrollingFrame", Main)
LogFrame.Name = "Log frame"
LogFrame.Size = UDim2.new(0,189,0,374)
LogFrame.Position = UDim2.new(0.317,0,0,0)
LogFrame.CanvasSize = UDim2.new()
LogFrame.ScrollBarImageTransparency = 1
LogFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
LogFrame.BackgroundTransparency = 0.4
LogFrame.BorderSizePixel = 0

local Layout = Instance.new("UIListLayout", LogFrame)
Layout.Padding = UDim.new(0,6)

-- LOG TEMPLATE
local function createLog(data)
    local log = Instance.new("Frame", LogFrame)
    log.Size = UDim2.new(1,-12,0,55)
    log.BackgroundColor3 = Color3.fromRGB(199,31,0)
    log.BorderSizePixel = 0
    Instance.new("UICorner", log).CornerRadius = UDim.new(0,4)

    local name = Instance.new("TextLabel", log)
    name.Text = data.brainrot
    name.Size = UDim2.new(0.55,0,0.5,0)
    name.Position = UDim2.new(0.03,0,0.05,0)
    name.BackgroundTransparency = 1
    name.TextColor3 = Color3.new(1,1,1)
    name.TextSize = 18
    name.FontFace = KrypthFont

    local mps = Instance.new("TextLabel", log)
    mps.Text = "$"..tostring(data.mps).."/s"
    mps.Size = UDim2.new(0.55,0,0.4,0)
    mps.Position = UDim2.new(0.03,0,0.55,0)
    mps.BackgroundTransparency = 1
    mps.TextColor3 = Color3.new(1,1,1)
    mps.TextSize = 16
    mps.FontFace = KrypthFont

    local join = Instance.new("TextButton", log)
    join.Text = "JOIN"
    join.Size = UDim2.new(0,68,0,40)
    join.Position = UDim2.new(0.6,0,0.15,0)
    join.TextColor3 = Color3.new(1,1,1)
    join.TextSize = 20
    join.FontFace = KrypthFont
    join.BackgroundColor3 = Color3.fromRGB(199,31,0)
    join.BorderSizePixel = 0
    Instance.new("UICorner", join).CornerRadius = UDim.new(0,2)
    Instance.new("UIStroke", join).Color = Color3.fromRGB(237,40,0)

    join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            data.placeId,
            data.jobId,
            Player
        )
    end)
end

-- LOGIC
local function clearLogs()
    for _,v in ipairs(LogFrame:GetChildren()) do
        if v:IsA("Frame") then v:Destroy() end
    end
    LogFrame.CanvasSize = UDim2.new()
end

local function fetchServers()
    local res = request({Url = SERVER_URL, Method = "GET"})
    if not res or not res.Body then return end

    local ok, data = pcall(function()
        return HttpService:JSONDecode(res.Body)
    end)

    if not ok or type(data) ~= "table" then
        warn("Invalid JSON from server")
        return
    end

    clearLogs()
    for _,server in ipairs(data) do
        createLog(server)
    end

    task.wait()
    LogFrame.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 10)
end

-- BUTTON HOOKS
RefreshBtn.MouseButton1Click:Connect(fetchServers)

ClearBtn.MouseButton1Click:Connect(clearLogs)

AutoBtn.MouseButton1Click:Connect(function()
    AUTO_JOIN = not AUTO_JOIN
    AutoBtn.Text = AUTO_JOIN and "AUTO JOIN: ON" or "AUTO JOIN"
end)

-- AUTO JOIN LOOP
task.spawn(function()
    while true do
        task.wait(REFRESH_DELAY)
        if AUTO_JOIN then
            local res = request({Url = SERVER_URL, Method = "GET"})
            if res and res.Body then
                local ok, data = pcall(function()
                    return HttpService:JSONDecode(res.Body)
                end)
                if ok and data[1] then
                    TeleportService:TeleportToPlaceInstance(
                        data[1].placeId,
                        data[1].jobId,
                        Player
                    )
                end
            end
        end
    end
end)

-- INIT
fetchServers()

-- =====================================
-- Krypth Auto Joiner (FINAL FIX)
-- =====================================

repeat task.wait() until game:IsLoaded()

-- ===== SERVICES =====
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer

-- ===== HTTP (DELTA / KRNL SAFE) =====
local http_request =
    (syn and syn.request) or
    (http and http.request) or
    (fluxus and fluxus.request) or
    (krnl and krnl.request) or
    (electron and electron.request)

if type(http_request) ~= "function" then
    warn("HTTP not supported on this executor")
    return
end

-- ===== CONFIG =====
local SERVER_URL = "https://compilation-chairs-activation-norm.trycloudflare.com/servers"
local AUTO_JOIN = false
local REFRESH_DELAY = 5

-- ===== FONT =====
local KrypthFont = Font.fromEnum(Enum.Font.GothamBold)

-- ===== GUI =====
local Gui = Instance.new("ScreenGui")
Gui.Name = "KrypthAJ"
Gui.ResetOnSpawn = false
Gui.Parent = Player:WaitForChild("PlayerGui")

local Main = Instance.new("Frame", Gui)
Main.Size = UDim2.new(0,380,0,420)
Main.Position = UDim2.new(0.37,0,0.16,0)
Main.BackgroundColor3 = Color3.fromRGB(26,26,26)
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,6)
Instance.new("UIDragDetector", Main)

local stroke = Instance.new("UIStroke", Main)
stroke.Color = Color3.fromRGB(220,40,20)
stroke.Thickness = 2

local Title = Instance.new("TextLabel", Main)
Title.Text = "Krypth AJ"
Title.FontFace = KrypthFont
Title.TextSize = 26
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0.03,0,0.02,0)
Title.Size = UDim2.new(0,200,0,30)
Title.TextXAlignment = Enum.TextXAlignment.Left

local LogsText = Instance.new("TextLabel", Main)
LogsText.Text = "LOGS"
LogsText.FontFace = KrypthFont
LogsText.TextSize = 22
LogsText.TextColor3 = Color3.new(1,1,1)
LogsText.BackgroundTransparency = 1
LogsText.Position = UDim2.new(0.63,0,0.03,0)
LogsText.Size = UDim2.new(0,100,0,24)
LogsText.TextXAlignment = Enum.TextXAlignment.Left

local ButtonHolder = Instance.new("Frame", Main)
ButtonHolder.BackgroundTransparency = 1
ButtonHolder.Position = UDim2.new(0.03,0,0.12,0)
ButtonHolder.Size = UDim2.new(0,120,0,350)

local function makeButton(text,y)
    local b = Instance.new("TextButton", ButtonHolder)
    b.Size = UDim2.new(1,0,0,40)
    b.Position = UDim2.new(0,0,0,y)
    b.Text = text
    b.FontFace = KrypthFont
    b.TextSize = 18
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(200,35,20)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,4)
    return b
end

local RefreshBtn = makeButton("REFRESH",0)
local AutoBtn = makeButton("AUTO JOIN",55)
local ClearBtn = makeButton("CLEAR",110)

local Logs = Instance.new("ScrollingFrame", Main)
Logs.Position = UDim2.new(0.36,0,0.12,0)
Logs.Size = UDim2.new(0,230,0,340)
Logs.ScrollBarImageTransparency = 1
Logs.CanvasSize = UDim2.new()
Logs.BackgroundColor3 = Color3.fromRGB(0,0,0)
Logs.BackgroundTransparency = 0.35
Instance.new("UICorner", Logs).CornerRadius = UDim.new(0,6)

local Layout = Instance.new("UIListLayout", Logs)
Layout.Padding = UDim.new(0,8)

-- ===== LOG FUNCTIONS =====
local function clearLogs()
    for _,v in ipairs(Logs:GetChildren()) do
        if v:IsA("Frame") then v:Destroy() end
    end
    Logs.CanvasSize = UDim2.new()
end

local function createLog(s)
    if type(s) ~= "table" then return end

    local brainrotName = tostring(s.brainrot or "Unknown")
    local mpsValue = tonumber(s.mps) or tonumber(s.money) or 0
    local placeId = tonumber(s.placeId)
    local jobId = tostring(s.jobId or "")

    if not placeId or jobId == "" then return end

    local f = Instance.new("Frame", Logs)
    f.Size = UDim2.new(1,-10,0,62)
    f.BackgroundColor3 = Color3.fromRGB(180,30,20)
    Instance.new("UICorner", f).CornerRadius = UDim.new(0,5)

    local name = Instance.new("TextLabel", f)
    name.Text = brainrotName
    name.FontFace = KrypthFont
    name.TextSize = 18
    name.TextColor3 = Color3.new(1,1,1)
    name.BackgroundTransparency = 1
    name.Position = UDim2.new(0.03,0,0.05,0)
    name.Size = UDim2.new(0.65,0,0.45,0)
    name.TextXAlignment = Enum.TextXAlignment.Left

    local mps = Instance.new("TextLabel", f)
    mps.Text = "$"..mpsValue.."/s"
    mps.FontFace = KrypthFont
    mps.TextSize = 16
    mps.TextColor3 = Color3.new(1,1,1)
    mps.BackgroundTransparency = 1
    mps.Position = UDim2.new(0.03,0,0.55,0)
    mps.Size = UDim2.new(0.65,0,0.4,0)
    mps.TextXAlignment = Enum.TextXAlignment.Left

    local join = Instance.new("TextButton", f)
    join.Text = "JOIN"
    join.FontFace = KrypthFont
    join.TextSize = 18
    join.TextColor3 = Color3.new(1,1,1)
    join.BackgroundColor3 = Color3.fromRGB(140,20,15)
    join.Size = UDim2.new(0,70,0,42)
    join.Position = UDim2.new(1,-80,0.5,-21)
    Instance.new("UICorner", join).CornerRadius = UDim.new(0,4)

    join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(placeId, jobId, Player)
    end)

    task.wait()
    Logs.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 10)
end

-- ===== FETCH =====
local function fetchServers()
    local res = http_request({ Url = SERVER_URL, Method = "GET" })
    if not res or not res.Body then return end

    local data
    pcall(function()
        data = HttpService:JSONDecode(res.Body)
    end)

    if type(data) ~= "table" then return end

    clearLogs()
    for _,s in ipairs(data) do
        createLog(s)
    end
end

-- ===== BUTTONS =====
RefreshBtn.MouseButton1Click:Connect(fetchServers)
ClearBtn.MouseButton1Click:Connect(clearLogs)

AutoBtn.MouseButton1Click:Connect(function()
    AUTO_JOIN = not AUTO_JOIN
    AutoBtn.Text = AUTO_JOIN and "AUTO JOIN: ON" or "AUTO JOIN"
end)

-- ===== AUTO JOIN =====
task.spawn(function()
    while true do
        task.wait(REFRESH_DELAY)
        if AUTO_JOIN then
            local r = http_request({ Url = SERVER_URL, Method = "GET" })
            if r and r.Body then
                local d
                pcall(function()
                    d = HttpService:JSONDecode(r.Body)
                end)
                if type(d) == "table" and d[1] then
                    TeleportService:TeleportToPlaceInstance(
                        tonumber(d[1].placeId),
                        tostring(d[1].jobId),
                        Player
                    )
                end
            end
        end
    end
end)

-- ===== START =====
fetchServers()
